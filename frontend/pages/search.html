<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŸ¥è¯†æ£€ç´¢ - åŸå­ç‰©ç†æ™ºèƒ½è¯¾å ‚ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="../assets/css/base.css">
    <link rel="stylesheet" href="../assets/css/layout.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>âš›ï¸</text></svg>">
    <style>
        /* æœç´¢é¡µé¢ç‰¹å®šæ ·å¼ */
        .search-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .search-box {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--space-2xl);
            position: relative;
            overflow: hidden;
        }

        .search-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary-main), var(--accent-gold), var(--primary-main));
        }

        .search-form {
            display: flex;
            gap: var(--space-md);
            align-items: flex-end;
        }

        .search-input-group {
            flex: 1;
        }

        .search-input {
            width: 100%;
            padding: var(--space-lg);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            transition: all var(--transition-normal);
            background: var(--bg-primary);
        }

        .search-input:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
            background: white;
        }

        .search-button {
            min-width: 120px;
            height: 56px;
            border-radius: var(--radius-lg);
        }

        .search-filters {
            display: flex;
            gap: var(--space-md);
            margin-top: var(--space-lg);
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .filter-select {
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-md);
            background: var(--bg-primary);
            font-size: 0.875rem;
        }

        /* ç”¨æˆ·åŒºåŸŸæ ·å¼ */
        .user-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 1.2rem;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: 1px solid rgba(45, 90, 71, 0.1);
            border-radius: 20px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(45, 90, 71, 0.08);
        }

        .user-section:hover {
            background: linear-gradient(135deg, #ffffff 0%, #faf8f5 100%);
            border-color: var(--accent-gold);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.15);
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.3rem;
            box-shadow: 0 3px 10px rgba(45, 90, 71, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .user-avatar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: rotate(45deg);
            transition: all 0.6s;
            opacity: 0;
        }

        .user-section:hover .user-avatar::before {
            opacity: 1;
            transform: rotate(45deg) translate(50%, 50%);
        }

        .user-section:hover .user-avatar {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(45, 90, 71, 0.4);
        }

        .user-info {
            display: flex;
            flex-direction: column;
            gap: 0.3rem;
        }

        .username {
            font-weight: 600;
            color: var(--primary-dark);
            font-size: 0.95rem;
            line-height: 1.2;
        }

        .user-role {
            font-size: 0.8rem;
            color: #6c757d;
            background: linear-gradient(135deg, rgba(45, 90, 71, 0.1) 0%, rgba(45, 90, 71, 0.05) 100%);
            padding: 0.3rem 0.6rem;
            border-radius: 10px;
            font-weight: 500;
            border: 1px solid rgba(45, 90, 71, 0.1);
        }

        .user-section .btn-ghost {
            background: transparent;
            border: 1px solid rgba(45, 90, 71, 0.2);
            color: var(--primary-dark);
            padding: 0.5rem 1.2rem;
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .user-section .btn-ghost::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(45, 90, 71, 0.1), transparent);
            transition: left 0.4s;
        }

        .user-section .btn-ghost:hover::before {
            left: 100%;
        }

        .user-section .btn-ghost:hover {
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-light) 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(45, 90, 71, 0.3);
        }

        .results-container {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            overflow: hidden;
        }

        .results-header {
            padding: var(--space-xl);
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-count {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .results-sort {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .results-list {
            padding: var(--space-lg);
        }

        .result-item {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--border-light);
            transition: all var(--transition-normal);
            position: relative;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-item:hover {
            background: var(--bg-secondary);
            transform: translateX(4px);
        }

        .result-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0;
            background: var(--accent-gold);
            transition: width var(--transition-normal);
        }

        .result-item:hover::before {
            width: 4px;
        }

        .result-title {
            font-family: var(--font-display);
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: var(--space-sm);
            line-height: 1.4;
        }

        .result-snippet {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: var(--space-md);
        }

        .result-meta {
            display: flex;
            gap: var(--space-lg);
            align-items: center;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .result-score {
            background: var(--primary-main);
            color: white;
            padding: var(--space-xs) var(--space-sm);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 500;
        }

        .result-source {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .highlight {
            background: var(--accent-gold);
            color: var(--primary-dark);
            padding: 0.125em 0.25em;
            border-radius: var(--radius-sm);
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: var(--space-3xl);
            color: var(--text-muted);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: var(--space-lg);
            opacity: 0.5;
        }

        .suggested-searches {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-sm);
            justify-content: center;
            margin-top: var(--space-xl);
        }

        .suggested-search {
            background: var(--bg-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-full);
            padding: var(--space-sm) var(--space-md);
            font-size: 0.875rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .suggested-search:hover {
            background: var(--primary-main);
            color: white;
            border-color: var(--primary-main);
            transform: translateY(-2px);
        }

        .loading-results {
            text-align: center;
            padding: var(--space-3xl);
        }

        .loading-skeleton {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            height: 20px;
            margin-bottom: var(--space-md);
            position: relative;
            overflow: hidden;
        }

        .loading-skeleton::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.4),
                transparent
            );
            animation: shimmer 1.5s infinite;
        }

        .skeleton-title { width: 70%; height: 24px; }
        .skeleton-text { width: 100%; }
        .skeleton-short { width: 40%; }

        /* æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ */
        .mode-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(248, 249, 250, 0.8);
            padding: 0.5rem;
            border-radius: 16px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }

        .mode-tab {
            flex: 1;
            padding: 1rem 2rem;
            border: none;
            background: transparent;
            color: #6c757d;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .mode-tab:hover {
            color: #495057;
            background: rgba(255, 255, 255, 0.6);
        }

        .mode-tab.active {
            color: #ffffff;
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-light) 100%);
            box-shadow: 0 4px 15px rgba(45, 90, 71, 0.3);
        }

        .mode-content {
            display: none;
        }

        .mode-content.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        /* çŸ¥è¯†ç‚¹ç›®å½•æ ·å¼ */
        .browse-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .knowledge-catalog {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), 0 2px 8px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            border: 1px solid rgba(45, 90, 71, 0.1);
        }

        .catalog-header {
            padding: 2.5rem 2rem;
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-light) 100%);
            color: white;
            position: relative;
            overflow: hidden;
        }

        .catalog-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.08'%3E%3Ccircle cx='30' cy='30' r='4'/%3E%3Ccircle cx='10' cy='10' r='3'/%3E%3Ccircle cx='50' cy='10' r='3'/%3E%3Ccircle cx='10' cy='50' r='3'/%3E%3Ccircle cx='50' cy='50' r='3'/%3E%3C/g%3E%3C/svg%3E") repeat;
            opacity: 0.6;
        }

        .catalog-header > * {
            position: relative;
            z-index: 1;
        }

        .catalog-header h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0 0 0.5rem 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .catalog-header p {
            margin: 0;
            opacity: 0.95;
            font-size: 1rem;
        }

        .catalog-chapters {
            padding: 1.5rem;
        }

        .chapter-item {
            margin-bottom: 1rem;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            border: 1px solid rgba(45, 90, 71, 0.1);
            transition: all 0.3s ease;
        }

        .chapter-item:hover {
            box-shadow: 0 4px 16px rgba(45, 90, 71, 0.1);
        }

        .chapter-header {
            padding: 1.25rem 1.5rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s ease;
            user-select: none;
        }

        .chapter-header:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
        }

        .chapter-header.active {
            background: linear-gradient(135deg, var(--primary-main) 0%, var(--primary-light) 100%);
            color: white;
        }

        .chapter-icon {
            font-size: 0.875rem;
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .chapter-header.active .chapter-icon {
            transform: rotate(90deg);
        }

        .chapter-title {
            flex: 1;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .chapter-count {
            font-size: 0.875rem;
            opacity: 0.8;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
        }

        .chapter-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background: white;
        }

        .chapter-content.active {
            max-height: 2000px;
        }

        .knowledge-item {
            padding: 1rem 1.5rem 1rem 3rem;
            border-bottom: 1px solid rgba(45, 90, 71, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .knowledge-item:last-child {
            border-bottom: none;
        }

        .knowledge-item:hover {
            background: linear-gradient(135deg, rgba(45, 90, 71, 0.05) 0%, rgba(45, 90, 71, 0.02) 100%);
            padding-left: 3.5rem;
        }

        .kp-icon {
            font-size: 1rem;
        }

        .kp-title {
            font-weight: 500;
            color: var(--primary-dark);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .search-button {
                width: 100%;
            }
            
            .search-filters {
                flex-direction: column;
                gap: var(--space-sm);
            }
            
            .results-header {
                flex-direction: column;
                gap: var(--space-md);
                align-items: flex-start;
            }
            
            .result-meta {
                flex-direction: column;
                gap: var(--space-sm);
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- å¯¼èˆªæ  -->
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1><a href="../index.html" style="color: inherit;">âš›ï¸ åŸå­ç‰©ç†æ™ºèƒ½è¯¾å ‚</a></h1>
                </div>
                <div class="nav-menu">
                    <a href="search.html" class="nav-link active">çŸ¥è¯†æ£€ç´¢</a>
                    <a href="qa.html" class="nav-link">æ™ºèƒ½é—®ç­”</a>
                    <a href="recommend.html" class="nav-link">å­¦ä¹ æ¨è</a>
                    <a href="profile.html" class="nav-link">å­¦æƒ…åˆ†æ</a>
                    <a href="teacher.html" class="nav-link teacher-only" style="display: none;">æ•™å¸ˆç«¯</a>
                </div>
                <div class="nav-user">
                    <!-- æœªç™»å½•çŠ¶æ€ -->
                    <div id="login-section" class="login-section">
                        <button id="login-btn" class="btn btn-primary btn-sm">ğŸ” ç™»å½•</button>
                    </div>
                    
                    <!-- å·²ç™»å½•çŠ¶æ€ -->
                    <div id="user-section" class="user-section" style="display: none;">
                        <div class="user-avatar" id="user-avatar">
                            <span id="avatar-text">U</span>
                        </div>
                        <div class="user-info">
                            <span id="username" class="username">ç”¨æˆ·å</span>
                            <span id="user-role" class="user-role">å­¦ç”Ÿ</span>
                        </div>
                        <button id="logout-btn" class="btn btn-ghost btn-sm">é€€å‡º</button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <main class="main-content">
            <div class="container">
                <div class="page-header">
                    <h1 class="page-title">çŸ¥è¯†æ£€ç´¢ç³»ç»Ÿ</h1>
                    <p class="page-subtitle">å¿«é€Ÿæœç´¢åŸå­ç‰©ç†å­¦ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œè·å–ç²¾å‡†çš„æ¦‚å¿µè§£é‡Šå’Œç†è®ºé˜è¿°</p>
                </div>

                <div class="search-container">
                    <!-- æ¨¡å¼åˆ‡æ¢æ ‡ç­¾ -->
                    <div class="mode-tabs">
                        <button class="mode-tab active" data-mode="search">æœç´¢æ¨¡å¼</button>
                        <button class="mode-tab" data-mode="browse">æµè§ˆæ¨¡å¼</button>
                    </div>

                    <!-- æœç´¢æ¨¡å¼ -->
                    <div id="search-mode" class="mode-content active">
                        <!-- æœç´¢æ¡† -->
                        <div class="search-box">
                        <form id="search-form" class="search-form">
                            <div class="search-input-group">
                                <input type="text" id="search-input" class="search-input" 
                                       placeholder="è¯·è¾“å…¥æ‚¨è¦æœç´¢çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼šæ³¢ç²’äºŒè±¡æ€§ã€åŸå­è½¨é“..." 
                                       required>
                            </div>
                            <button type="submit" class="btn btn-primary search-button">
                                <span class="search-text">æœç´¢</span>
                                <span class="loading" style="display: none;"></span>
                            </button>
                        </form>
                        
                        <div class="search-filters">
                            <div class="filter-group">
                                <label for="top-k">ç»“æœæ•°é‡:</label>
                                <select id="top-k" class="filter-select">
                                    <option value="5">5ä¸ªç»“æœ</option>
                                    <option value="10" selected>10ä¸ªç»“æœ</option>
                                    <option value="20">20ä¸ªç»“æœ</option>
                                    <option value="50">50ä¸ªç»“æœ</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="sort-by">æ’åºæ–¹å¼:</label>
                                <select id="sort-by" class="filter-select">
                                    <option value="relevance" selected>ç›¸å…³æ€§</option>
                                    <option value="date">æ—¶é—´</option>
                                    <option value="score">è¯„åˆ†</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- æœç´¢ç»“æœ -->
                    <div class="results-container" id="results-container" style="display: none;">
                        <div class="results-header">
                            <div class="results-count" id="results-count">
                                æ‰¾åˆ° 0 ä¸ªç›¸å…³ç»“æœ
                            </div>
                            <div class="results-sort">
                                <span>æœç´¢ç”¨æ—¶: <span id="search-time">0</span>ms</span>
                            </div>
                        </div>
                        <div class="results-list" id="results-list">
                            <!-- æœç´¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>

                    <!-- ç©ºçŠ¶æ€ -->
                    <div class="empty-state" id="empty-state">
                        <p>è¾“å…¥å…³é”®è¯æœç´¢åŸå­ç‰©ç†å­¦ç›¸å…³å†…å®¹ï¼Œå‘ç°çŸ¥è¯†çš„å¥¥ç§˜</p>
                        <div class="suggested-searches">
                            <span class="suggested-search" onclick="performSearch('æ³¢ç²’äºŒè±¡æ€§')">æ³¢ç²’äºŒè±¡æ€§</span>
                            <span class="suggested-search" onclick="performSearch('åŸå­ç»“æ„')">åŸå­ç»“æ„</span>
                            <span class="suggested-search" onclick="performSearch('é‡å­æ•°')">é‡å­æ•°</span>
                            <span class="suggested-search" onclick="performSearch('åŸå­è½¨é“')">åŸå­è½¨é“</span>
                            <span class="suggested-search" onclick="performSearch('ç”µå­è‡ªæ—‹')">ç”µå­è‡ªæ—‹</span>
                            <span class="suggested-search" onclick="performSearch('è–›å®šè°”æ–¹ç¨‹')">è–›å®šè°”æ–¹ç¨‹</span>
                            <span class="suggested-search" onclick="performSearch('é‡å­åŠ›å­¦')">é‡å­åŠ›å­¦</span>
                            <span class="suggested-search" onclick="performSearch('åŸå­å…‰è°±')">åŸå­å…‰è°±</span>
                        </div>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div class="loading-results" id="loading-results" style="display: none;">
                        <div class="loading-spinner"></div>
                        <p class="loading-text">æ­£åœ¨æœç´¢çŸ¥è¯†åº“...</p>
                        
                        <!-- éª¨æ¶å± -->
                        <div style="margin-top: 2rem;">
                            <div class="loading-skeleton skeleton-title"></div>
                            <div class="loading-skeleton skeleton-text"></div>
                            <div class="loading-skeleton skeleton-short"></div>
                            <br>
                            <div class="loading-skeleton skeleton-title"></div>
                            <div class="loading-skeleton skeleton-text"></div>
                            <div class="loading-skeleton skeleton-short"></div>
                        </div>
                    </div>
                </div>

                <!-- æµè§ˆæ¨¡å¼ -->
                <div id="browse-mode" class="mode-content">
                    <div class="browse-container">
                        <!-- çŸ¥è¯†ç‚¹ç›®å½• -->
                        <div class="knowledge-catalog">
                            <div class="catalog-header">
                                <h3>ğŸ“– åŸå­ç‰©ç†å­¦çŸ¥è¯†ä½“ç³»</h3>
                                <p>æŒ‰ç« èŠ‚æµè§ˆæ‰€æœ‰çŸ¥è¯†ç‚¹</p>
                            </div>
                            
                            <div class="catalog-chapters">
                                <!-- ç¬¬1ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬1ç«  åŸå­çš„åŸºæœ¬çŠ¶å†µ</span>
                                        <span class="chapter-count">12ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('åŸå­çš„åŸºæœ¬æ¦‚å¿µ')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">åŸå­çš„åŸºæœ¬æ¦‚å¿µ</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('åŸå­çš„ç»„æˆ')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">åŸå­çš„ç»„æˆ</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('åŸå­æ ¸')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">åŸå­æ ¸</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('ç”µå­äº‘')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ç”µå­äº‘</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬2ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬2ç«  åŸå­çš„èƒ½çº§å’Œè¾å°„</span>
                                        <span class="chapter-count">15ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('èƒ½çº§æ¦‚å¿µ')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">èƒ½çº§æ¦‚å¿µ</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('åŸå­å…‰è°±')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">åŸå­å…‰è°±</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('ç»å°”ç†è®º')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ç»å°”ç†è®º</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ°¢åŸå­å…‰è°±')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ°¢åŸå­å…‰è°±</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬3ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬3ç«  é‡å­åŠ›å­¦åˆæ­¥</span>
                                        <span class="chapter-count">18ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('æ³¢ç²’äºŒè±¡æ€§')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ³¢ç²’äºŒè±¡æ€§</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('å¾·å¸ƒç½—æ„æ³¢')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">å¾·å¸ƒç½—æ„æ³¢</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('è–›å®šè°”æ–¹ç¨‹')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">è–›å®šè°”æ–¹ç¨‹</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ³¢å‡½æ•°')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ³¢å‡½æ•°</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('ä¸ç¡®å®šæ€§åŸç†')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ä¸ç¡®å®šæ€§åŸç†</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬4ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬4ç«  ç¢±é‡‘å±åŸå­å’Œç”µå­è‡ªæ—‹</span>
                                        <span class="chapter-count">10ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('ç¢±é‡‘å±åŸå­')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ç¢±é‡‘å±åŸå­</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('ç”µå­è‡ªæ—‹')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ç”µå­è‡ªæ—‹</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('è‡ªæ—‹é‡å­æ•°')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">è‡ªæ—‹é‡å­æ•°</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬5ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬5ç«  å¤šç”µå­åŸå­</span>
                                        <span class="chapter-count">14ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('æ³¡åˆ©ä¸ç›¸å®¹åŸç†')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ³¡åˆ©ä¸ç›¸å®¹åŸç†</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('ç”µå­ç»„æ€')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ç”µå­ç»„æ€</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ´ªç‰¹è§„åˆ™')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ´ªç‰¹è§„åˆ™</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬6ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬6ç«  å¤–åœºä¸­çš„åŸå­</span>
                                        <span class="chapter-count">11ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('å¡æ›¼æ•ˆåº”')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">å¡æ›¼æ•ˆåº”</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ–¯å¡”å…‹æ•ˆåº”')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ–¯å¡”å…‹æ•ˆåº”</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('ç£åœºä¸­çš„åŸå­')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">ç£åœºä¸­çš„åŸå­</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬8ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬8ç«  Xå°„çº¿</span>
                                        <span class="chapter-count">9ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('Xå°„çº¿çš„äº§ç”Ÿ')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">Xå°„çº¿çš„äº§ç”Ÿ</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('Xå°„çº¿è°±')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">Xå°„çº¿è°±</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('åº·æ™®é¡¿æ•ˆåº”')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">åº·æ™®é¡¿æ•ˆåº”</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- ç¬¬10ç«  -->
                                <div class="chapter-item">
                                    <div class="chapter-header" onclick="toggleChapter(this)">
                                        <span class="chapter-icon">â–¶</span>
                                        <span class="chapter-title">ç¬¬10ç«  åŸå­æ ¸</span>
                                        <span class="chapter-count">13ä¸ªçŸ¥è¯†ç‚¹</span>
                                    </div>
                                    <div class="chapter-content">
                                        <div class="knowledge-item" onclick="viewKnowledge('åŸå­æ ¸çš„ç»„æˆ')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">åŸå­æ ¸çš„ç»„æˆ</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ ¸åŠ›')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ ¸åŠ›</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ”¾å°„æ€§')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ”¾å°„æ€§</span>
                                        </div>
                                        <div class="knowledge-item" onclick="viewKnowledge('æ ¸ååº”')">
                                            <span class="kp-icon">ğŸ“Œ</span>
                                            <span class="kp-title">æ ¸ååº”</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- é¡µè„š -->
        <footer class="footer">
            <div class="container">
                <p>&copy; 2026åŸå­ç‰©ç†æ™ºèƒ½è¯¾å ‚ç³»ç»Ÿ | æ¢ç´¢å¾®è§‚ä¸–ç•Œï¼Œå¯å‘ç§‘å­¦æ€ç»´</p>
            </div>
        </footer>
    </div>

    <!-- åŠ è½½è„šæœ¬ -->
    <script src="../assets/js/utils.js?v=4"></script>
    <script src="../assets/js/api.js?v=4"></script>
    <script src="../assets/js/modals.js?v=4"></script>
    <script src="../assets/js/auth.js?v=4"></script>
    <script src="../assets/js/event.js?v=4"></script>

    <script>
        let currentCourseId = 1; // é»˜è®¤è¯¾ç¨‹ID
        let searchStartTime = 0;

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initAuth();
            recordEvent('view_search', {});
            
            // ç»‘å®šæ¨¡å¼åˆ‡æ¢
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchMode(this.dataset.mode);
                });
            });
            
            // æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æœ‰æœç´¢æŸ¥è¯¢
            const urlParams = getUrlParams();
            if (urlParams.q) {
                document.getElementById('search-input').value = urlParams.q;
                performSearch(urlParams.q);
            }
            
            // æ£€æŸ¥localStorageä¸­æ˜¯å¦æœ‰æœç´¢æŸ¥è¯¢
            const savedQuery = localStorage.getItem('searchQuery');
            if (savedQuery && !urlParams.q) {
                document.getElementById('search-input').value = savedQuery;
                performSearch(savedQuery);
                localStorage.removeItem('searchQuery');
            }
        });

        // åˆ‡æ¢æ¨¡å¼
        function switchMode(mode) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            // æ›´æ–°å†…å®¹æ˜¾ç¤º
            document.querySelectorAll('.mode-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${mode}-mode`).classList.add('active');
            
            // è®°å½•äº‹ä»¶
            recordEvent('switch_search_mode', { mode: mode });
        }

        // åˆ‡æ¢ç« èŠ‚å±•å¼€/æ”¶èµ·
        function toggleChapter(header) {
            const content = header.nextElementSibling;
            const isActive = header.classList.contains('active');
            
            // å…³é—­æ‰€æœ‰å…¶ä»–ç« èŠ‚
            document.querySelectorAll('.chapter-header').forEach(h => {
                h.classList.remove('active');
                h.nextElementSibling.classList.remove('active');
            });
            
            // åˆ‡æ¢å½“å‰ç« èŠ‚
            if (!isActive) {
                header.classList.add('active');
                content.classList.add('active');
            }
        }

        // æŸ¥çœ‹çŸ¥è¯†ç‚¹
        function viewKnowledge(keyword) {
            // åˆ‡æ¢åˆ°æœç´¢æ¨¡å¼
            switchMode('search');
            
            // æ‰§è¡Œæœç´¢
            setTimeout(() => {
                performSearch(keyword);
            }, 300);
        }

        // æœç´¢è¡¨å•æäº¤
        document.getElementById('search-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const query = document.getElementById('search-input').value.trim();
            if (!query) return;
            
            performSearch(query);
        });

        // æ‰§è¡Œæœç´¢
        async function performSearch(query) {
            const searchInput = document.getElementById('search-input');
            const emptyState = document.getElementById('empty-state');
            const loadingResults = document.getElementById('loading-results');
            const resultsContainer = document.getElementById('results-container');
            
            // æ›´æ–°è¾“å…¥æ¡†
            searchInput.value = query;
            
            // æ›´æ–°URL
            setUrlParam('q', query);
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            emptyState.style.display = 'none';
            resultsContainer.style.display = 'none';
            loadingResults.style.display = 'block';
            
            searchStartTime = Date.now();
            
            try {
                const topK = parseInt(document.getElementById('top-k').value);
                const response = await kbAPI.searchKnowledge(query, currentCourseId, topK);
                
                console.log('API response:', response);
                console.log('Response hits:', response.hits);
                console.log('Hits length:', response.hits ? response.hits.length : 'undefined');
                
                const searchTime = Date.now() - searchStartTime;
                displayResults(response.hits, query, searchTime);
                
                // è®°å½•æœç´¢äº‹ä»¶
                recordEvent('search_knowledge', {
                    query: query,
                    results_count: response.hits.length,
                    search_time: searchTime
                });
                
            } catch (error) {
                console.error('Search error:', error);
                loadingResults.style.display = 'none';
                showNoResults(query);
                handleAPIError(error, 'çŸ¥è¯†æ£€ç´¢');
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displayResults(hits, query, searchTime) {
            console.log('displayResults called with hits:', hits, 'query:', query, 'searchTime:', searchTime);
            
            const loadingResults = document.getElementById('loading-results');
            const resultsContainer = document.getElementById('results-container');
            const resultsCount = document.getElementById('results-count');
            const searchTimeSpan = document.getElementById('search-time');
            const resultsList = document.getElementById('results-list');
            
            loadingResults.style.display = 'none';
            
            if (!hits || hits.length === 0) {
                console.log('No hits to display');
                showNoResults(query);
                return;
            }
            
            console.log('Displaying', hits.length, 'results');
            
            // æ›´æ–°ç»“æœç»Ÿè®¡
            resultsCount.textContent = `æ‰¾åˆ° ${hits.length} ä¸ªç›¸å…³ç»“æœ`;
            searchTimeSpan.textContent = searchTime;
            
            // æ¸…ç©ºç»“æœåˆ—è¡¨
            resultsList.innerHTML = '';
            
            // æ·»åŠ ç»“æœé¡¹
            hits.forEach((hit, index) => {
                console.log('Creating result item for hit', index, hit);
                const resultItem = createResultItem(hit, query, index);
                resultsList.appendChild(resultItem);
            });
            
            console.log('Setting results container to visible');
            resultsContainer.style.display = 'block';
            
            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            const items = resultsList.querySelectorAll('.result-item');
            items.forEach((item, index) => {
                item.style.opacity = '0';
                item.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    item.style.transition = 'all 0.4s ease-out';
                    item.style.opacity = '1';
                    item.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }

        // åˆ›å»ºç»“æœé¡¹
        function createResultItem(hit, query, index) {
            const item = document.createElement('div');
            item.className = 'result-item';
            
            // é«˜äº®æœç´¢å…³é”®è¯
            const highlightedSnippet = highlightKeywords(hit.snippet, query);
            const highlightedTitle = highlightKeywords(`æ–‡æ¡£ç‰‡æ®µ ${index + 1}`, query);
            
            // è®¡ç®—ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”
            const similarityPercent = Math.round(hit.score * 100);
            
            item.innerHTML = `
                <div class="result-title">${highlightedTitle}</div>
                <div class="result-snippet">${highlightedSnippet}</div>
                <div class="result-meta">
                    <div class="result-score">${similarityPercent}% åŒ¹é…</div>
                    <div class="result-source">
                        <span>æ–‡æ¡£</span>
                        <span>æ–‡æ¡£ID: ${hit.document_id}</span>
                    </div>
                    <div class="result-source">
                        <span>ç‰‡æ®µ</span>
                        <span>ç‰‡æ®µID: ${hit.chunk_id}</span>
                    </div>
                </div>
            `;
            
            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            item.addEventListener('click', function() {
                showResultDetail(hit);
            });
            
            return item;
        }

        // é«˜äº®å…³é”®è¯
        function highlightKeywords(text, query) {
            if (!query) return text;
            
            const keywords = query.split(/\s+/).filter(k => k.length > 0);
            let highlightedText = text;
            
            keywords.forEach(keyword => {
                const regex = new RegExp(`(${keyword})`, 'gi');
                highlightedText = highlightedText.replace(regex, '<span class="highlight">$1</span>');
            });
            
            return highlightedText;
        }

        // æ˜¾ç¤ºæ— ç»“æœçŠ¶æ€
        function showNoResults(query) {
            const resultsContainer = document.getElementById('results-container');
            const resultsList = document.getElementById('results-list');
            const resultsCount = document.getElementById('results-count');
            
            resultsCount.textContent = 'æœªæ‰¾åˆ°ç›¸å…³ç»“æœ';
            resultsList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">æ— ç»“æœ</div>
                    <h3>æœªæ‰¾åˆ°ç›¸å…³å†…å®¹</h3>
                    <p>æ²¡æœ‰æ‰¾åˆ°ä¸ "${query}" ç›¸å…³çš„å†…å®¹ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯</p>
                    <div class="suggested-searches">
                        <span class="suggested-search" onclick="performSearch('æ³¢ç²’äºŒè±¡æ€§')">æ³¢ç²’äºŒè±¡æ€§</span>
                        <span class="suggested-search" onclick="performSearch('åŸå­ç»“æ„')">åŸå­ç»“æ„</span>
                        <span class="suggested-search" onclick="performSearch('é‡å­æ•°')">é‡å­æ•°</span>
                        <span class="suggested-search" onclick="performSearch('åŸå­è½¨é“')">åŸå­è½¨é“</span>
                    </div>
                </div>
            `;
            
            resultsContainer.style.display = 'block';
        }

        // æ˜¾ç¤ºç»“æœè¯¦æƒ…
        function showResultDetail(hit) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="modal-title">å†…å®¹è¯¦æƒ…</h2>
                        <button class="close" onclick="this.closest('.modal').remove()">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div style="margin-bottom: 1rem;">
                            <strong>ç›¸ä¼¼åº¦:</strong> ${Math.round(hit.score * 100)}%
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>æ–‡æ¡£ID:</strong> ${hit.document_id}
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <strong>å†…å®¹:</strong>
                        </div>
                        <div style="background: var(--bg-secondary); padding: 1rem; border-radius: var(--radius-md); line-height: 1.6;">
                            ${hit.snippet}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" onclick="copyToClipboard('${hit.snippet.replace(/'/g, "\\'")}')">å¤åˆ¶å†…å®¹</button>
                        <button class="btn btn-primary" onclick="this.closest('.modal').remove()">å…³é—­</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
    </script>
</body>
</html>